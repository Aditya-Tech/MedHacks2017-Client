<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

		<style>
			#container {
			    margin: 0px auto;
			    width: 600x;
			    height: 400px;
			    border: 10px #333 solid;
			}
			#videoElement {
			    width: 600px;
			    height: 400x;
			    background-color: #666;
			}
			#canvas {
			    width: 200px;
			    height: 120px;
			    background-color: #CCC;
			}
			body{
	margin:0;
	padding:0;
	font-family:"arial",heletica,sans-serif;
	font-size:12px;
    background: #2980b9 url('https://static.tumblr.com/03fbbc566b081016810402488936fbae/pqpk3dn/MRSmlzpj3/tumblr_static_bg3.png') repeat 0 0;
	-webkit-animation: 10s linear 0s normal none infinite animate;
	-moz-animation: 10s linear 0s normal none infinite animate;
	-ms-animation: 10s linear 0s normal none infinite animate;
	-o-animation: 10s linear 0s normal none infinite animate;
	animation: 10s linear 0s normal none infinite animate;
 
}
 
@-webkit-keyframes animate {
	from {background-position:0 0;}
	to {background-position: 500px 0;}
}
 
@-moz-keyframes animate {
	from {background-position:0 0;}
	to {background-position: 500px 0;}
}
 
@-ms-keyframes animate {
	from {background-position:0 0;}
	to {background-position: 500px 0;}
}
 
@-o-keyframes animate {
	from {background-position:0 0;}
	to {background-position: 500px 0;}
}
 
@keyframes animate {
	from {background-position:0 0;}
	to {background-position: 500px 0;}
}

#login-dp{
    min-width: 250px;
    padding: 14px 14px 0;
    overflow:hidden;
    background-color:rgba(255,255,255,.8);
}
#login-dp .help-block{
    font-size:12px    
}
#login-dp .bottom{
    background-color:rgba(255,255,255,.8);
    border-top:1px solid #ddd;
    clear:both;
    padding:14px;
}
#login-dp .social-buttons{
    margin:12px 0    
}
#login-dp .social-buttons a{
    width: 49%;
}
#login-dp .form-group {
    margin-bottom: 10px;
}
.btn-fb{
    color: #fff;
    background-color:#3b5998;
}
.btn-fb:hover{
    color: #fff;
    background-color:#496ebc 
}
.btn-tw{
    color: #fff;
    background-color:#55acee;
}
.btn-tw:hover{
    color: #fff;
    background-color:#59b5fa;
}
@media(max-width:768px){
    #login-dp{
        background-color: inherit;
        color: #fff;
    }
    #login-dp .bottom{
        background-color: inherit;
        border-top:0 none;
    }
}

		</style>
	</head>


	<body>	
	<nav class="navbar navbar-default navbar-inverse" role="navigation">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
	        <span class="sr-only">Toggle navigation</span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <a class="navbar-brand" href="#">CareGivr</a>
	    </div>

	    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	      <ul class="nav navbar-nav">
	        <li><a href="/search_patient">Search Patients</a></li>
	        <li class="active"><a href="/new_patient">New Patient</a></li>
	        <li class="dropdown">
	          <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <span class="caret"></span></a>
	          <ul class="dropdown-menu" role="menu">
	            <li><a href="#">Action</a></li>
	            <li><a href="#">Another action</a></li>
	            <li><a href="#">Something else here</a></li>
	            <li class="divider"></li>
	            <li><a href="#">Separated link</a></li>
	            <li class="divider"></li>
	            <li><a href="#">One more separated link</a></li>
	          </ul>
	        </li>
	      </ul>
	      <form class="navbar-form navbar-left" role="search">
	        <div class="form-group">
	          <input type="text" class="form-control" placeholder="Search">
	        </div>
	        <button type="submit" class="btn btn-default">Submit</button>
	      </form>
	      <ul class="nav navbar-nav navbar-right">
	        <li><p class="navbar-text">Already have an account?</p></li>
	        <li class="dropdown">
	          <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b>Login</b> <span class="caret"></span></a>
				<ul id="login-dp" class="dropdown-menu">
					<li>
						 <div class="row">
								<div class="col-md-12">
									Login via
									<div class="social-buttons">
										<a href="#" class="btn btn-fb"><i class="fa fa-facebook"></i> Facebook</a>
										<a href="#" class="btn btn-tw"><i class="fa fa-twitter"></i> Twitter</a>
									</div>
	                                or
									 <form class="form" role="form" method="post" action="login" accept-charset="UTF-8" id="login-nav">
											<div class="form-group">
												 <label class="sr-only" for="exampleInputEmail2">Email address</label>
												 <input type="email" class="form-control" id="exampleInputEmail2" placeholder="Email address" required>
											</div>
											<div class="form-group">
												 <label class="sr-only" for="exampleInputPassword2">Password</label>
												 <input type="password" class="form-control" id="exampleInputPassword2" placeholder="Password" required>
	                                             <div class="help-block text-right"><a href="">Forget the password ?</a></div>
											</div>
											<div class="form-group">
												 <button type="submit" class="btn btn-primary btn-block">Sign in</button>
											</div>
											<div class="checkbox">
												 <label>
												 <input type="checkbox"> keep me logged-in
												 </label>
											</div>
									 </form>
								</div>
								<div class="bottom text-center">
									New here ? <a href="#"><b>Join Us</b></a>
								</div>
						 </div>
					</li>
				</ul>
	        </li>
	      </ul>
	    </div>
	  </div>
	</nav>

	<div class="row">
		<div class="col-md-8 col-md-offset-2 text-block text-center" style="color:white;">
			<h1>Add a new Patient</h1>
		</div>
		<div class="col-md-8 col-md-offset-2 text-block text-center" style="height: 500px; padding-top:40px;">
		    <video autoplay id="videoElement">
		    </video>
		</div>
		<div class="col-md-8 col-md-offset-2 text-block text-center" style="padding-top:40px;">
			<input type="button" value="Capture" id="save" />	
		</div>
		<div class="col-md-8 col-md-offset-2 text-block text-center" style="display:none; padding-top:40px;">
			<canvas id="canvas" width="500" height="375"></canvas>
		</div>
	</div>

	<script>

		var video = document.querySelector("#videoElement");

		// check for getUserMedia support
		navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
		 
		if (navigator.getUserMedia) {       
		    // get webcam feed if available
		    navigator.getUserMedia({video: true}, handleVideo, videoError);
		}
		 
		function handleVideo(stream) {
		    // if found attach feed to video element
		    video.src = window.URL.createObjectURL(stream);
		}
		 
		function videoError(e) {
		    // no webcam found - do something
		}
		var v,canvas,context,w,h;
		var imgtag = document.getElementById('imgtag'); // get reference to img tag
		var sel = document.getElementById('fileselect'); // get reference to file select input element
		var paused = false;

		document.addEventListener('DOMContentLoaded', function(){
		    // when DOM loaded, get canvas 2D context and store width and height of element
		    v = document.getElementById('videoElement');
		    canvas = document.getElementById('canvas');
		    context = canvas.getContext('2d');
		    context.scale(0.25, 0.25);

		    w = canvas.width;
		    h = canvas.height;

		},false);

		function draw(v,c,w,h) {

		   if (v.ended) return false; // if no video, exit here

		   context.drawImage(v,0,0,w,h); // draw video feed to canvas
		   
		   uri = canvas.toDataURL("image/png").split("base64,")[1].trim(); // convert canvas to data URI
		   document.getElementById("FaceID").input = uri;
		   console.log(uri); // uncomment line to log URI for testing

		   $.ajax({
			  url: "https://floating-harbor-59952.herokuapp.com/register",
			  type: "POST",
			  dataType: "JSON",
			  data: {"image" : uri},
			  success: function(res) {
			  	console.log(res);
			  }
			});
		 }

			document.getElementById('save').addEventListener('click',function(e){
		    	if (paused) {
		    		video.play();
		    		document.getElementById("save").value = "Capture";
		    		paused = false;
		    	} else {
		    		video.pause();
		    		draw(v,context,w,h);
		    		document.getElementById("save").value = "Try again";
		    		paused = true;
		    	}
		    
					});
			</script>

			<form action="/verify_patient" method="POST">
			  <input type="text" style="display:none; visibility:hidden;" id="FaceID" placeholder="FaceID" name="FaceID">
			  <button type="submit">Submit</button>
			</form>


	</body>


</html>

